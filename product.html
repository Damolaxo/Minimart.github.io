{% extends "base.html" %}
{% block title %}Products - MyShop{% endblock %}
{% block content %}
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3>Products{% if category_name %} â€” {{ category_name }}{% endif %}</h3>
    <form class="d-flex" method="get" action="{{ url_for('products') }}">
      <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search" name="q" value="{{ request.args.get('q','') }}">
      <button class="btn btn-outline-secondary" type="submit">Search</button>
    </form>
  </div>

  <div class="row">
    {% for product in products %}
      <div class="col-md-4 mb-4">
        <div class="card h-100">
          <img src="{{ product.image_url }}" class="card-img-top" alt="{{ product.title }}">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">{{ product.title }}</h5>
            <p class="card-text">{{ product.short_description }}</p>
            <div class="d-flex justify-content-between align-items-center mt-auto">
              <span class="fs-5">${{ "%.2f"|format(product.price) }}</span>
              <div>
                <a href="{{ url_for('product_detail', product_id=product.id) }}" class="btn btn-sm btn-primary">Details</a>
                <form method="post" action="{{ url_for('add_to_cart', product_id=product.id) }}" style="display:inline;">
                  <button class="btn btn-sm btn-outline-success">Add</button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    {% else %}
      <div class="col-12"><p>No products found.</p></div>
    {% endfor %}
  </div>

  <!-- pagination placeholder -->
  {% if pagination %}
    <nav aria-label="Page navigation">
      <ul class="pagination">
        {% if pagination.prev_page %}
          <li class="page-item"><a class="page-link" href="{{ url_for('products', page=pagination.prev_page) }}">Previous</a></li>
        {% endif %}
        {% for p in pagination.pages %}
          <li class="page-item {% if p==pagination.current %}active{% endif %}">
            <a class="page-link" href="{{ url_for('products', page=p) }}">{{ p }}</a>
          </li>
        {% endfor %}
        {% if pagination.next_page %}
          <li class="page-item"><a class="page-link" href="{{ url_for('products', page=pagination.next_page) }}">Next</a></li>
        {% endif %}
      </ul>
    </nav>
  {% endif %}
{% endblock %}
